def na=double.nan;
input ORBegin = 0930;
input OREnd = 0931;
input ShowTodayOnly={"No", default "Yes"};
def s=ShowTodayOnly;
Def ORActive = if secondstilltime(OREnd)>0 AND secondsfromtime(ORBegin)>=0 then 1 else 0;
def today=if s==0 OR getday()==getlastday() AND secondsfromtime(ORBegin)>=0 then 1 else 0;
Rec ORHigh = if ORHigh[1]==0 or ORActive[1]==0 AND ORActive==1 then high else if ORActive AND high>ORHigh[1] then high else ORHigh[1];
Rec ORLow = if ORLow [1] ==0 or ORActive [1] ==0 AND ORActive ==1 then low else if ORActive AND low < orlow [1] then low else ORLow [1];
Def ORWidth = ORHigh - ORLow;
Rec TargetHigh1 = ORHigh + ORWidth;
Rec TargetHigh2 = ORHigh + ORWidth*2;
Rec TargetHigh3 = ORHigh + ORWidth*3;
Rec TargetLow1 = ORLow - ORWidth;
Rec TargetLow2 = ORLow - ORWidth*2;
Rec TargetLow3 = ORLow - ORWidth*3;
Plot ORH=if today<1 then na else ORHigh;
Plot ORL=if today<1 then na else ORLow;
Plot TH1 = if today<1 then na else TargetHigh1;
Plot TH2 = if today<1 then na else TargetHigh2;
Plot TH3 = if today<1 then na else TargetHigh3;
Plot TL1 = if today<1 then na else TargetLow1;
Plot TL2 = if today<1 then na else TargetLow2;
Plot TL3 = if today<1 then na else TargetLow3;
ORH.setdefaultcolor(Color.GREEN);
ORH.setStyle(Curve.FIRM);
ORH.setlineweight(2);
ORL.setdefaultcolor(color.red);
ORL.setStyle(Curve.FIRM);
ORL.setlineweight(2);
TH1.setdefaultColor(Color.LIGHT_GREEN);
TH1.setstyle(Curve.MEDIUM_DASH);
TH2.setdefaultColor(Color.GREEN);
TH2.setstyle(Curve.LONG_DASH);
TH3.setdefaultColor(Color.GREEN);
TH3.setstyle(Curve.LONG_DASH);
TL1.setdefaultColor(Color.LIGHT_RED);
TL1.setstyle(Curve.MEDIUM_DASH);
TL2.setdefaultColor(Color.RED);
TL2.setstyle(Curve.LONG_DASH);
TL3.setdefaultColor(Color.RED);
TL3.setstyle(Curve.LONG_DASH);
# Addlabel(yes,"H: " + round(ORHigh,2) + " ", Color.green);
# Addlabel(yes,"L: " + round(ORLow,2) + " ", color.red);
Rec shareSize = 60/ORWidth;
# Addlabel(yes,"#: " + round(shareSize,0) + " ", Color.PLUM);
addCloud(ORH,ORL,createColor(211,211,211), createColor(211,211,211));

